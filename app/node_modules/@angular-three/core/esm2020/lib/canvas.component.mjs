import { ChangeDetectionStrategy, Component, ElementRef, EventEmitter, HostBinding, Input, NgZone, Output, Self, ViewChild, } from '@angular/core';
import * as THREE from 'three';
import { NgtLoopService } from './services/loop.service';
import { NgtResize } from './services/resize.service';
import { NgtAnimationFrameStore } from './stores/animation-frame.store';
import { EnhancedRxState } from './stores/enhanced-rx-state';
import { NgtEventsStore } from './stores/events.store';
import { NgtPerformanceStore } from './stores/performance.store';
import { NgtStore } from './stores/store';
import * as i0 from "@angular/core";
import * as i1 from "./stores/store";
import * as i2 from "./stores/performance.store";
import * as i3 from "./stores/events.store";
import * as i4 from "./stores/animation-frame.store";
import * as i5 from "./services/loop.service";
export class NgtCanvas extends EnhancedRxState {
    constructor(store, performanceStore, eventsStore, animationFrameStore, loopService, ngZone) {
        super();
        this.store = store;
        this.performanceStore = performanceStore;
        this.eventsStore = eventsStore;
        this.animationFrameStore = animationFrameStore;
        this.loopService = loopService;
        this.ngZone = ngZone;
        this.hostClass = true;
        this.created = new EventEmitter();
        this.pointermissed = new EventEmitter();
    }
    set vr(vr) {
        this.store.set({ vr: vr === '' ? true : vr });
    }
    set linear(linear) {
        this.store.set({ linear: linear === '' ? true : linear });
    }
    set flat(flat) {
        this.store.set({ flat: flat === '' ? true : flat });
    }
    set frameloop(frameloop) {
        this.store.set({ frameloop });
    }
    set orthographic(orthographic) {
        this.store.set({ orthographic: orthographic === '' ? true : orthographic });
    }
    set performance(performance) {
        this.store.set({ performance });
    }
    set size(size) {
        this.store.set({ size });
    }
    set dpr(dpr) {
        this.store.set({ dpr });
    }
    set clock(clock) {
        this.store.set({ clock });
    }
    set raycaster(raycaster) {
        this.store.set({ raycasterOptions: raycaster });
    }
    set shadows(shadows) {
        this.store.set({ shadows });
    }
    set camera(cameraOptions) {
        this.store.set({ cameraOptions });
    }
    set scene(sceneOptions) {
        this.store.set({ sceneOptions });
    }
    set gl(glOptions) {
        this.store.set({ glOptions });
    }
    set rendererCanvas(v) {
        this.store.actions.canvasElement(v.nativeElement);
    }
    ngOnInit() {
        // if there is handler to pointermissed on the canvas
        // update pointermissed in events store so that
        // events util will handle it
        if (this.pointermissed.observed) {
            this.eventsStore.set({
                pointerMissed: (event) => {
                    this.pointermissed.emit(event);
                },
            });
        }
        this.hold(this.store.select('ready'), (ready) => {
            if (ready) {
                this.ngZone.runOutsideAngular(() => {
                    const state = this.store.get();
                    this.eventsStore.actions.element(state.renderer.domElement);
                    this.loopService.invalidate(state);
                    this.created.emit(state);
                });
            }
        });
    }
}
NgtCanvas.ɵfac = i0.ɵɵngDeclareFactory({ minVersion: "12.0.0", version: "13.0.3", ngImport: i0, type: NgtCanvas, deps: [{ token: i1.NgtStore, self: true }, { token: i2.NgtPerformanceStore, self: true }, { token: i3.NgtEventsStore, self: true }, { token: i4.NgtAnimationFrameStore, self: true }, { token: i5.NgtLoopService, self: true }, { token: i0.NgZone }], target: i0.ɵɵFactoryTarget.Component });
NgtCanvas.ɵcmp = i0.ɵɵngDeclareComponent({ minVersion: "12.0.0", version: "13.0.3", type: NgtCanvas, selector: "ngt-canvas", inputs: { vr: "vr", linear: "linear", flat: "flat", frameloop: "frameloop", orthographic: "orthographic", performance: "performance", size: "size", dpr: "dpr", clock: "clock", raycaster: "raycaster", shadows: "shadows", camera: "camera", scene: "scene", gl: "gl" }, outputs: { created: "created", pointermissed: "pointermissed" }, host: { properties: { "class.ngt-canvas": "this.hostClass" } }, providers: [
        NgtResize,
        NgtStore,
        NgtPerformanceStore,
        NgtEventsStore,
        NgtAnimationFrameStore,
        NgtLoopService,
    ], viewQueries: [{ propertyName: "rendererCanvas", first: true, predicate: ["rendererCanvas"], descendants: true }], usesInheritance: true, ngImport: i0, template: ` <canvas #rendererCanvas></canvas> `, isInline: true, styles: [":host{display:block;position:relative;width:100%;height:100%;overflow:hidden}:host canvas{display:block}\n"], changeDetection: i0.ChangeDetectionStrategy.OnPush });
i0.ɵɵngDeclareClassMetadata({ minVersion: "12.0.0", version: "13.0.3", ngImport: i0, type: NgtCanvas, decorators: [{
            type: Component,
            args: [{
                    selector: 'ngt-canvas',
                    template: ` <canvas #rendererCanvas></canvas> `,
                    styles: [
                        `
      :host {
        display: block;
        position: relative;
        width: 100%;
        height: 100%;
        overflow: hidden;
      }

      :host canvas {
        display: block;
      }
    `,
                    ],
                    changeDetection: ChangeDetectionStrategy.OnPush,
                    providers: [
                        NgtResize,
                        NgtStore,
                        NgtPerformanceStore,
                        NgtEventsStore,
                        NgtAnimationFrameStore,
                        NgtLoopService,
                    ],
                }]
        }], ctorParameters: function () { return [{ type: i1.NgtStore, decorators: [{
                    type: Self
                }] }, { type: i2.NgtPerformanceStore, decorators: [{
                    type: Self
                }] }, { type: i3.NgtEventsStore, decorators: [{
                    type: Self
                }] }, { type: i4.NgtAnimationFrameStore, decorators: [{
                    type: Self
                }] }, { type: i5.NgtLoopService, decorators: [{
                    type: Self
                }] }, { type: i0.NgZone }]; }, propDecorators: { hostClass: [{
                type: HostBinding,
                args: ['class.ngt-canvas']
            }], vr: [{
                type: Input
            }], linear: [{
                type: Input
            }], flat: [{
                type: Input
            }], frameloop: [{
                type: Input
            }], orthographic: [{
                type: Input
            }], performance: [{
                type: Input
            }], size: [{
                type: Input
            }], dpr: [{
                type: Input
            }], clock: [{
                type: Input
            }], raycaster: [{
                type: Input
            }], shadows: [{
                type: Input
            }], camera: [{
                type: Input
            }], scene: [{
                type: Input
            }], gl: [{
                type: Input
            }], created: [{
                type: Output
            }], pointermissed: [{
                type: Output
            }], rendererCanvas: [{
                type: ViewChild,
                args: ['rendererCanvas']
            }] } });
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiY2FudmFzLmNvbXBvbmVudC5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uLy4uL3BhY2thZ2VzL2NvcmUvc3JjL2xpYi9jYW52YXMuY29tcG9uZW50LnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBLE9BQU8sRUFDTCx1QkFBdUIsRUFDdkIsU0FBUyxFQUNULFVBQVUsRUFDVixZQUFZLEVBQ1osV0FBVyxFQUNYLEtBQUssRUFDTCxNQUFNLEVBRU4sTUFBTSxFQUNOLElBQUksRUFDSixTQUFTLEdBQ1YsTUFBTSxlQUFlLENBQUM7QUFDdkIsT0FBTyxLQUFLLEtBQUssTUFBTSxPQUFPLENBQUM7QUFDL0IsT0FBTyxFQUFFLGNBQWMsRUFBRSxNQUFNLHlCQUF5QixDQUFDO0FBQ3pELE9BQU8sRUFBRSxTQUFTLEVBQUUsTUFBTSwyQkFBMkIsQ0FBQztBQUN0RCxPQUFPLEVBQUUsc0JBQXNCLEVBQUUsTUFBTSxnQ0FBZ0MsQ0FBQztBQUN4RSxPQUFPLEVBQUUsZUFBZSxFQUFFLE1BQU0sNEJBQTRCLENBQUM7QUFDN0QsT0FBTyxFQUFFLGNBQWMsRUFBRSxNQUFNLHVCQUF1QixDQUFDO0FBQ3ZELE9BQU8sRUFBRSxtQkFBbUIsRUFBRSxNQUFNLDRCQUE0QixDQUFDO0FBQ2pFLE9BQU8sRUFBRSxRQUFRLEVBQUUsTUFBTSxnQkFBZ0IsQ0FBQzs7Ozs7OztBQXdDMUMsTUFBTSxPQUFPLFNBQVUsU0FBUSxlQUFlO0lBbUU1QyxZQUNrQixLQUFlLEVBQ2YsZ0JBQXFDLEVBQ3JDLFdBQTJCLEVBQzNCLG1CQUEyQyxFQUMzQyxXQUEyQixFQUNuQyxNQUFjO1FBRXRCLEtBQUssRUFBRSxDQUFDO1FBUFEsVUFBSyxHQUFMLEtBQUssQ0FBVTtRQUNmLHFCQUFnQixHQUFoQixnQkFBZ0IsQ0FBcUI7UUFDckMsZ0JBQVcsR0FBWCxXQUFXLENBQWdCO1FBQzNCLHdCQUFtQixHQUFuQixtQkFBbUIsQ0FBd0I7UUFDM0MsZ0JBQVcsR0FBWCxXQUFX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QTBCcEMsU0FBUztrQkE1QnJCLFNBQVM7bUJBQUM7b0JBQ1QsUUFBUSxFQUFFLFlBQVk7b0JBQ3RCLFFBQVEsRUFBRSxxQ0FBcUM7b0JBQy9DLE1BQU0sRUFBRTt3QkFDTjs7Ozs7Ozs7Ozs7O0tBWUM7cUJBQ0Y7b0JBQ0QsZUFBZSxFQUFFLHVCQUF1QixDQUFDLE1BQU07b0JBQy9DLFNBQVMsRUFBRTt3QkFDVCxTQUFTO3dCQUNULFFBQVE7d0JBQ1IsbUJBQW1CO3dCQUNuQixjQUFjO3dCQUNkLHNCQUFzQjt3QkFDdEIsY0FBYztxQkFDZjtpQkFDRjs7MEJBcUVJLElBQUk7OzBCQUNKLElBQUk7OzBCQUNKLElBQUk7OzBCQUNKLElBQUk7OzBCQUNKLElBQUk7aUVBdkUwQixTQUFTO3NCQUF6QyxXQUFXO3VCQUFDLGtCQUFrQjtnQkFFbEIsRUFBRTtzQkFBZCxLQUFLO2dCQUlPLE1BQU07c0JBQWxCLEtBQUs7Z0JBSU8sSUFBSTtzQkFBaEIsS0FBSztnQkFJTyxTQUFTO3NCQUFyQixLQUFLO2dCQUlPLFlBQVk7c0JBQXhCLEtBQUs7Z0JBSU8sV0FBVztzQkFBdkIsS0FBSztnQkFJTyxJQUFJO3NCQUFoQixLQUFLO2dCQUlPLEdBQUc7c0JBQWYsS0FBSztnQkFJTyxLQUFLO3NCQUFqQixLQUFLO2dCQUlPLFNBQVM7c0JBQXJCLEtBQUs7Z0JBSU8sT0FBTztzQkFBbkIsS0FBSztnQkFJTyxNQUFNO3NCQUFsQixLQUFLO2dCQUlPLEtBQUs7c0JBQWpCLEtBQUs7Z0JBSU8sRUFBRTtzQkFBZCxLQUFLO2dCQUlJLE9BQU87c0JBQWhCLE1BQU07Z0JBQ0csYUFBYTtzQkFBdEIsTUFBTTtnQkFHSCxjQUFjO3NCQURqQixTQUFTO3VCQUFDLGdCQUFnQiIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7XG4gIENoYW5nZURldGVjdGlvblN0cmF0ZWd5LFxuICBDb21wb25lbnQsXG4gIEVsZW1lbnRSZWYsXG4gIEV2ZW50RW1pdHRlcixcbiAgSG9zdEJpbmRpbmcsXG4gIElucHV0LFxuICBOZ1pvbmUsXG4gIE9uSW5pdCxcbiAgT3V0cHV0LFxuICBTZWxmLFxuICBWaWV3Q2hpbGQsXG59IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xuaW1wb3J0ICogYXMgVEhSRUUgZnJvbSAndGhyZWUnO1xuaW1wb3J0IHsgTmd0TG9vcFNlcnZpY2UgfSBmcm9tICcuL3NlcnZpY2VzL2xvb3Auc2VydmljZSc7XG5pbXBvcnQgeyBOZ3RSZXNpemUgfSBmcm9tICcuL3NlcnZpY2VzL3Jlc2l6ZS5zZXJ2aWNlJztcbmltcG9ydCB7IE5ndEFuaW1hdGlvbkZyYW1lU3RvcmUgfSBmcm9tICcuL3N0b3Jlcy9hbmltYXRpb24tZnJhbWUuc3RvcmUnO1xuaW1wb3J0IHsgRW5oYW5jZWRSeFN0YXRlIH0gZnJvbSAnLi9zdG9yZXMvZW5oYW5jZWQtcngtc3RhdGUnO1xuaW1wb3J0IHsgTmd0RXZlbnRzU3RvcmUgfSBmcm9tICcuL3N0b3Jlcy9ldmVudHMuc3RvcmUnO1xuaW1wb3J0IHsgTmd0UGVyZm9ybWFuY2VTdG9yZSB9IGZyb20gJy4vc3RvcmVzL3BlcmZvcm1hbmNlLnN0b3JlJztcbmltcG9ydCB7IE5ndFN0b3JlIH0gZnJvbSAnLi9zdG9yZXMvc3RvcmUnO1xuaW1wb3J0IHtcbiAgTmd0Q2FtZXJhT3B0aW9ucyxcbiAgTmd0Q3JlYXRlZFN0YXRlLFxuICBOZ3REcHIsXG4gIE5ndEdMT3B0aW9ucyxcbiAgTmd0UGVyZm9ybWFuY2UsXG4gIE5ndFJheWNhc3RlcixcbiAgTmd0U2NlbmVPcHRpb25zLFxuICBOZ3RTaXplLFxufSBmcm9tICcuL3R5cGVzJztcblxuQENvbXBvbmVudCh7XG4gIHNlbGVjdG9yOiAnbmd0LWNhbnZhcycsXG4gIHRlbXBsYXRlOiBgIDxjYW52YXMgI3JlbmRlcmVyQ2FudmFzPjwvY2FudmFzPiBgLFxuICBzdHlsZXM6IFtcbiAgICBgXG4gICAgICA6aG9zdCB7XG4gICAgICAgIGRpc3BsYXk6IGJsb2NrO1xuICAgICAgICBwb3NpdGlvbjogcmVsYXRpdmU7XG4gICAgICAgIHdpZHRoOiAxMDAlO1xuICAgICAgICBoZWlnaHQ6IDEwMCU7XG4gICAgICAgIG92ZXJmbG93OiBoaWRkZW47XG4gICAgICB9XG5cbiAgICAgIDpob3N0IGNhbnZhcyB7XG4gICAgICAgIGRpc3BsYXk6IGJsb2NrO1xuICAgICAgfVxuICAgIGAsXG4gIF0sXG4gIGNoYW5nZURldGVjdGlvbjogQ2hhbmdlRGV0ZWN0aW9uU3RyYXRlZ3kuT25QdXNoLFxuICBwcm92aWRlcnM6IFtcbiAgICBOZ3RSZXNpemUsXG4gICAgTmd0U3RvcmUsXG4gICAgTmd0UGVyZm9ybWFuY2VTdG9yZSxcbiAgICBOZ3RFdmVudHNTdG9yZSxcbiAgICBOZ3RBbmltYXRpb25GcmFtZVN0b3JlLFxuICAgIE5ndExvb3BTZXJ2aWNlLFxuICBdLFxufSlcbmV4cG9ydCBjbGFzcyBOZ3RDYW52YXMgZXh0ZW5kcyBFbmhhbmNlZFJ4U3RhdGUgaW1wbGVtZW50cyBPbkluaXQge1xuICBASG9zdEJpbmRpbmcoJ2NsYXNzLm5ndC1jYW52YXMnKSBob3N0Q2xhc3MgPSB0cnVlO1xuXG4gIEBJbnB1dCgpIHNldCB2cih2cjogYm9vbGVhbiB8ICcnKSB7XG4gICAgdGhpcy5zdG9yZS5zZXQoeyB2cjogdnIgPT09ICcnID8gdHJ1ZSA6IHZyIH0pO1xuICB9XG5cbiAgQElucHV0KCkgc2V0IGxpbmVhcihsaW5lYXI6IGJvb2xlYW4gfCAnJykge1xuICAgIHRoaXMuc3RvcmUuc2V0KHsgbGluZWFyOiBsaW5lYXIgPT09ICcnID8gdHJ1ZSA6IGxpbmVhciB9KTtcbiAgfVxuXG4gIEBJbnB1dCgpIHNldCBmbGF0KGZsYXQ6IGJvb2xlYW4gfCAnJykge1xuICAgIHRoaXMuc3RvcmUuc2V0KHsgZmxhdDogZmxhdCA9PT0gJycgPyB0cnVlIDogZmxhdCB9KTtcbiAgfVxuXG4gIEBJbnB1dCgpIHNldCBmcmFtZWxvb3AoZnJhbWVsb29wOiAnYWx3YXlzJyB8ICdkZW1hbmQnIHwgJ25ldmVyJykge1xuICAgIHRoaXMuc3RvcmUuc2V0KHsgZnJhbWVsb29wIH0pO1xuICB9XG5cbiAgQElucHV0KCkgc2V0IG9ydGhvZ3JhcGhpYyhvcnRob2dyYXBoaWM6IGJvb2xlYW4gfCAnJykge1xuICAgIHRoaXMuc3RvcmUuc2V0KHsgb3J0aG9ncmFwaGljOiBvcnRob2dyYXBoaWMgPT09ICcnID8gdHJ1ZSA6IG9ydGhvZ3JhcGhpYyB9KTtcbiAgfVxuXG4gIEBJbnB1dCgpIHNldCBwZXJmb3JtYW5jZShwZXJmb3JtYW5jZTogTmd0UGVyZm9ybWFuY2UpIHtcbiAgICB0aGlzLnN0b3JlLnNldCh7IHBlcmZvcm1hbmNlIH0pO1xuICB9XG5cbiAgQElucHV0KCkgc2V0IHNpemUoc2l6ZTogTmd0U2l6ZSkge1xuICAgIHRoaXMuc3RvcmUuc2V0KHsgc2l6ZSB9KTtcbiAgfVxuXG4gIEBJbnB1dCgpIHNldCBkcHIoZHByOiBOZ3REcHIpIHtcbiAgICB0aGlzLnN0b3JlLnNldCh7IGRwciB9KTtcbiAgfVxuXG4gIEBJbnB1dCgpIHNldCBjbG9jayhjbG9jazogVEhSRUUuQ2xvY2spIHtcbiAgICB0aGlzLnN0b3JlLnNldCh7IGNsb2NrIH0pO1xuICB9XG5cbiAgQElucHV0KCkgc2V0IHJheWNhc3RlcihyYXljYXN0ZXI6IFBhcnRpYWw8Tmd0UmF5Y2FzdGVyPikge1xuICAgIHRoaXMuc3RvcmUuc2V0KHsgcmF5Y2FzdGVyT3B0aW9uczogcmF5Y2FzdGVyIH0pO1xuICB9XG5cbiAgQElucHV0KCkgc2V0IHNoYWRvd3Moc2hhZG93czogYm9vbGVhbiB8IFBhcnRpYWw8VEhSRUUuV2ViR0xTaGFkb3dNYXA+KSB7XG4gICAgdGhpcy5zdG9yZS5zZXQoeyBzaGFkb3dzIH0pO1xuICB9XG5cbiAgQElucHV0KCkgc2V0IGNhbWVyYShjYW1lcmFPcHRpb25zOiBOZ3RDYW1lcmFPcHRpb25zKSB7XG4gICAgdGhpcy5zdG9yZS5zZXQoeyBjYW1lcmFPcHRpb25zIH0pO1xuICB9XG5cbiAgQElucHV0KCkgc2V0IHNjZW5lKHNjZW5lT3B0aW9uczogTmd0U2NlbmVPcHRpb25zKSB7XG4gICAgdGhpcy5zdG9yZS5zZXQoeyBzY2VuZU9wdGlvbnMgfSk7XG4gIH1cblxuICBASW5wdXQoKSBzZXQgZ2woZ2xPcHRpb25zOiBOZ3RHTE9wdGlvbnMpIHtcbiAgICB0aGlzLnN0b3JlLnNldCh7IGdsT3B0aW9ucyB9KTtcbiAgfVxuXG4gIEBPdXRwdXQoKSBjcmVhdGVkID0gbmV3IEV2ZW50RW1pdHRlcjxOZ3RDcmVhdGVkU3RhdGU+KCk7XG4gIEBPdXRwdXQoKSBwb2ludGVybWlzc2VkID0gbmV3IEV2ZW50RW1pdHRlcjxNb3VzZUV2ZW50PigpO1xuXG4gIEBWaWV3Q2hpbGQoJ3JlbmRlcmVyQ2FudmFzJylcbiAgc2V0IHJlbmRlcmVyQ2FudmFzKHY6IEVsZW1lbnRSZWY8SFRNTENhbnZhc0VsZW1lbnQ+KSB7XG4gICAgdGhpcy5zdG9yZS5hY3Rpb25zLmNhbnZhc0VsZW1lbnQodi5uYXRpdmVFbGVtZW50KTtcbiAgfVxuXG4gIGNvbnN0cnVjdG9yKFxuICAgIEBTZWxmKCkgcHJpdmF0ZSBzdG9yZTogTmd0U3RvcmUsXG4gICAgQFNlbGYoKSBwcml2YXRlIHBlcmZvcm1hbmNlU3RvcmU6IE5ndFBlcmZvcm1hbmNlU3RvcmUsXG4gICAgQFNlbGYoKSBwcml2YXRlIGV2ZW50c1N0b3JlOiBOZ3RFdmVudHNTdG9yZSxcbiAgICBAU2VsZigpIHByaXZhdGUgYW5pbWF0aW9uRnJhbWVTdG9yZTogTmd0QW5pbWF0aW9uRnJhbWVTdG9yZSxcbiAgICBAU2VsZigpIHByaXZhdGUgbG9vcFNlcnZpY2U6IE5ndExvb3BTZXJ2aWNlLFxuICAgIHByaXZhdGUgbmdab25lOiBOZ1pvbmVcbiAgKSB7XG4gICAgc3VwZXIoKTtcbiAgfVxuXG4gIG5nT25Jbml0KCkge1xuICAgIC8vIGlmIHRoZXJlIGlzIGhhbmRsZXIgdG8gcG9pbnRlcm1pc3NlZCBvbiB0aGUgY2FudmFzXG4gICAgLy8gdXBkYXRlIHBvaW50ZXJtaXNzZWQgaW4gZXZlbnRzIHN0b3JlIHNvIHRoYXRcbiAgICAvLyBldmVudHMgdXRpbCB3aWxsIGhhbmRsZSBpdFxuICAgIGlmICh0aGlzLnBvaW50ZXJtaXNzZWQub2JzZXJ2ZWQpIHtcbiAgICAgIHRoaXMuZXZlbnRzU3RvcmUuc2V0KHtcbiAgICAgICAgcG9pbnRlck1pc3NlZDogKGV2ZW50KSA9PiB7XG4gICAgICAgICAgdGhpcy5wb2ludGVybWlzc2VkLmVtaXQoZXZlbnQpO1xuICAgICAgICB9LFxuICAgICAgfSk7XG4gICAgfVxuXG4gICAgdGhpcy5ob2xkKHRoaXMuc3RvcmUuc2VsZWN0KCdyZWFkeScpLCAocmVhZHkpID0+IHtcbiAgICAgIGlmIChyZWFkeSkge1xuICAgICAgICB0aGlzLm5nWm9uZS5ydW5PdXRzaWRlQW5ndWxhcigoKSA9PiB7XG4gICAgICAgICAgY29uc3Qgc3RhdGUgPSB0aGlzLnN0b3JlLmdldCgpO1xuICAgICAgICAgIHRoaXMuZXZlbnRzU3RvcmUuYWN0aW9ucy5lbGVtZW50KHN0YXRlLnJlbmRlcmVyLmRvbUVsZW1lbnQpO1xuICAgICAgICAgIHRoaXMubG9vcFNlcnZpY2UuaW52YWxpZGF0ZShzdGF0ZSk7XG4gICAgICAgICAgdGhpcy5jcmVhdGVkLmVtaXQoc3RhdGUgYXMgTmd0Q3JlYXRlZFN0YXRlKTtcbiAgICAgICAgfSk7XG4gICAgICB9XG4gICAgfSk7XG4gIH1cbn1cbiJdfQ==