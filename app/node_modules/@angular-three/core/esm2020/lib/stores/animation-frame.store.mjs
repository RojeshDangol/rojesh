var _NgtAnimationFrameStore_instances, _NgtAnimationFrameStore_register, _NgtAnimationFrameStore_unregister;
import { __classPrivateFieldGet } from "tslib";
import { Injectable } from '@angular/core';
import { noop } from 'rxjs';
import { makeId } from '../utils/make-id';
import { EnhancedRxState, getActions } from './enhanced-rx-state';
import * as i0 from "@angular/core";
export class NgtAnimationFrameStore extends EnhancedRxState {
    constructor() {
        super();
        _NgtAnimationFrameStore_instances.add(this);
        this.actions = getActions();
        this.set({ animations: {}, subscribers: [], hasPriority: false });
        this.hold(this.select('animations'), (animations) => {
            const subscribers = Object.values(animations);
            subscribers.sort((a, b) => (a.priority || 0) - (b.priority || 0));
            const hasPriority = subscribers.some(({ priority }) => !!priority);
            this.set({ hasPriority, subscribers });
        });
        this.hold(this.actions.animationRecord$, __classPrivateFieldGet(this, _NgtAnimationFrameStore_instances, "m", _NgtAnimationFrameStore_register).bind(this));
        this.hold(this.actions.unsubscriberUuid$, __classPrivateFieldGet(this, _NgtAnimationFrameStore_instances, "m", _NgtAnimationFrameStore_unregister).bind(this));
    }
    register(animationRecord) {
        const uuid = animationRecord.obj?.uuid || makeId();
        this.actions.animationRecord({ ...animationRecord, uuid });
        return uuid;
    }
    ngOnDestroy() {
        this.set({ animations: {} });
        super.ngOnDestroy();
    }
}
_NgtAnimationFrameStore_instances = new WeakSet(), _NgtAnimationFrameStore_register = function _NgtAnimationFrameStore_register({ uuid, ...animationRecord } = {
    uuid: '',
    callback: noop,
}) {
    if (uuid) {
        this.set((state) => {
            return {
                animations: { ...state.animations, [uuid]: animationRecord },
            };
        });
    }
    return (prevRecord, isUnsub) => {
        if ((prevRecord && prevRecord.uuid !== uuid) || isUnsub) {
            __classPrivateFieldGet(this, _NgtAnimationFrameStore_instances, "m", _NgtAnimationFrameStore_unregister).call(this, uuid);
        }
    };
}, _NgtAnimationFrameStore_unregister = function _NgtAnimationFrameStore_unregister(uuid) {
    if (!uuid)
        return;
    this.set((state) => {
        const { [uuid]: _, ...animations } = state.animations;
        return { animations };
    });
};
NgtAnimationFrameStore.ɵfac = i0.ɵɵngDeclareFactory({ minVersion: "12.0.0", version: "13.0.3", ngImport: i0, type: NgtAnimationFrameStore, deps: [], target: i0.ɵɵFactoryTarget.Injectable });
NgtAnimationFrameStore.ɵprov = i0.ɵɵngDeclareInjectable({ minVersion: "12.0.0", version: "13.0.3", ngImport: i0, type: NgtAnimationFrameStore });
i0.ɵɵngDeclareClassMetadata({ minVersion: "12.0.0", version: "13.0.3", ngImport: i0, type: NgtAnimationFrameStore, decorators: [{
            type: Injectable
        }], ctorParameters: function () { return []; } });
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiYW5pbWF0aW9uLWZyYW1lLnN0b3JlLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vLi4vLi4vLi4vLi4vcGFja2FnZXMvY29yZS9zcmMvbGliL3N0b3Jlcy9hbmltYXRpb24tZnJhbWUuc3RvcmUudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7QUFBQSxPQUFPLEVBQUUsVUFBVSxFQUFFLE1BQU0sZUFBZSxDQUFDO0FBQzNDLE9BQU8sRUFBRSxJQUFJLEVBQUUsTUFBTSxNQUFNLENBQUM7QUFFNUIsT0FBTyxFQUFFLE1BQU0sRUFBRSxNQUFNLGtCQUFrQixDQUFDO0FBQzFDLE9BQU8sRUFBRSxlQUFlLEVBQUUsVUFBVSxFQUFFLE1BQU0scUJBQXFCLENBQUM7O0FBR2xFLE1BQU0sT0FBTyxzQkFBdUIsU0FBUSxlQUE0QztJQVl0RjtRQUNFLEtBQUssRUFBRSxDQUFDOztRQVpWLFlBQU8sR0FBRyxVQUFVLEVBR2hCLENBQUM7UUFVSCxJQUFJLENBQUMsR0FBRyxDQUFDLEVBQUUsVUFBVSxFQUFFLEVBQUUsRUFBRSxXQUFXLEVBQUUsRUFBRSxFQUFFLFdBQVcsRUFBRSxLQUFLLEVBQUUsQ0FBQyxDQUFDO1FBRWxFLElBQUksQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLE1BQU0sQ0FBQyxZQUFZLENBQUMsRUFBRSxDQUFDLFVBQVUsRUFBRSxFQUFFO1lBQ2xELE1BQU0sV0FBVyxHQUFHLE1BQU0sQ0FBQyxNQUFNLENBQUMsVUFBVSxDQUFDLENBQUM7WUFDOUMsV0FBVyxDQUFDLElBQUksQ0FBQyxDQUFDLENBQUMsRUFBRSxDQUFDLEVBQUUsRUFBRSxDQUFDLENBQUMsQ0FBQyxDQUFDLFFBQVEsSUFBSSxDQUFDLENBQUMsR0FBRyxDQUFDLENBQUMsQ0FBQyxRQUFRLElBQUksQ0FBQyxDQUFDLENBQUMsQ0FBQztZQUNsRSxNQUFNLFdBQVcsR0FBRyxXQUFXLENBQUMsSUFBSSxDQUFDLENBQUMsRUFBRSxRQUFRLEVBQUUsRUFBRSxFQUFFLENBQUMsQ0FBQyxDQUFDLFFBQVEsQ0FBQyxDQUFDO1lBQ25FLElBQUksQ0FBQyxHQUFHLENBQUMsRUFBRSxXQUFXLEVBQUUsV0FBVyxFQUFFLENBQUMsQ0FBQztRQUN6QyxDQUFDLENBQUMsQ0FBQztRQUNILElBQUksQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLE9BQU8sQ0FBQyxnQkFBZ0IsRUFBRSx1QkFBQSxJQUFJLDJFQUFVLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxDQUFDLENBQUM7UUFDcEUsSUFBSSxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsT0FBTyxDQUFDLGlCQUFpQixFQUFFLHVCQUFBLElBQUksNkVBQVksQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLENBQUMsQ0FBQztJQUN6RSxDQUFDO0lBbEJELFFBQVEsQ0FBQyxlQUFtQztRQUMxQyxNQUFNLElBQUksR0FBRyxlQUFlLENBQUMsR0FBRyxFQUFFLElBQUksSUFBSSxNQUFNLEVBQUUsQ0FBQztRQUNuRCxJQUFJLENBQUMsT0FBTyxDQUFDLGVBQWUsQ0FBQyxFQUFFLEdBQUcsZUFBZSxFQUFFLElBQUksRUFBRSxDQUFDLENBQUM7UUFDM0QsT0FBTyxJQUFJLENBQUM7SUFDZCxDQUFDO0lBZ0RELFdBQVc7UUFDVCxJQUFJLENBQUMsR0FBRyxDQUFDLEVBQUUsVUFBVSxFQUFFLEVBQUUsRUFBRSxDQUFDLENBQUM7UUFDN0IsS0FBSyxDQUFDLFdBQVcsRUFBRSxDQUFDO0lBQ3RCLENBQUM7O2dJQWxDQyxFQUFFLElBQUksRUFBRSxHQUFHLGVBQWUsS0FBNEM7SUFDcEUsSUFBSSxFQUFFLEVBQUU7SUFDUixRQUFRLEVBQUUsSUFBSTtDQUNmO0lBRUQsSUFBSSxJQUFJLEVBQUU7UUFDUixJQUFJLENBQUMsR0FBRyxDQUFDLENBQUMsS0FBSyxFQUFFLEVBQUU7WUFDakIsT0FBTztnQkFDTCxVQUFVLEVBQUUsRUFBRSxHQUFHLEtBQUssQ0FBQyxVQUFVLEVBQUUsQ0FBQyxJQUFJLENBQUMsRUFBRSxlQUFlLEVBQUU7YUFDN0QsQ0FBQztRQUNKLENBQUMsQ0FBQyxDQUFDO0tBQ0o7SUFFRCxPQUFPLENBQ0wsVUFBK0QsRUFDL0QsT0FBZ0IsRUFDaEIsRUFBRTtRQUNGLElBQUksQ0FBQyxVQUFVLElBQUksVUFBVSxDQUFDLElBQUksS0FBSyxJQUFJLENBQUMsSUFBSSxPQUFPLEVBQUU7WUFDdkQsdUJBQUEsSUFBSSw2RUFBWSxNQUFoQixJQUFJLEVBQWEsSUFBSSxDQUFDLENBQUM7U0FDeEI7SUFDSCxDQUFDLENBQUM7QUFDSixDQUFDLG1GQUVXLElBQVk7SUFDdEIsSUFBSSxDQUFDLElBQUk7UUFBRSxPQUFPO0lBQ2xCLElBQUksQ0FBQyxHQUFHLENBQUMsQ0FBQyxLQUFLLEVBQUUsRUFBRTtRQUNqQixNQUFNLEVBQUUsQ0FBQyxJQUFJLENBQUMsRUFBRSxDQUFDLEVBQUUsR0FBRyxVQUFVLEVBQUUsR0FBRyxLQUFLLENBQUMsVUFBVSxDQUFDO1FBQ3RELE9BQU8sRUFBRSxVQUFVLEVBQUUsQ0FBQztJQUN4QixDQUFDLENBQUMsQ0FBQztBQUNMLENBQUM7bUhBeERVLHNCQUFzQjt1SEFBdEIsc0JBQXNCOzJGQUF0QixzQkFBc0I7a0JBRGxDLFVBQVUiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBJbmplY3RhYmxlIH0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XG5pbXBvcnQgeyBub29wIH0gZnJvbSAncnhqcyc7XG5pbXBvcnQgeyBOZ3RBbmltYXRpb25GcmFtZVN0b3JlU3RhdGUsIE5ndEFuaW1hdGlvblJlY29yZCB9IGZyb20gJy4uL3R5cGVzJztcbmltcG9ydCB7IG1ha2VJZCB9IGZyb20gJy4uL3V0aWxzL21ha2UtaWQnO1xuaW1wb3J0IHsgRW5oYW5jZWRSeFN0YXRlLCBnZXRBY3Rpb25zIH0gZnJvbSAnLi9lbmhhbmNlZC1yeC1zdGF0ZSc7XG5cbkBJbmplY3RhYmxlKClcbmV4cG9ydCBjbGFzcyBOZ3RBbmltYXRpb25GcmFtZVN0b3JlIGV4dGVuZHMgRW5oYW5jZWRSeFN0YXRlPE5ndEFuaW1hdGlvbkZyYW1lU3RvcmVTdGF0ZT4ge1xuICBhY3Rpb25zID0gZ2V0QWN0aW9uczx7XG4gICAgYW5pbWF0aW9uUmVjb3JkOiBOZ3RBbmltYXRpb25SZWNvcmQgJiB7IHV1aWQ6IHN0cmluZyB9O1xuICAgIHVuc3Vic2NyaWJlclV1aWQ6IHN0cmluZztcbiAgfT4oKTtcblxuICByZWdpc3RlcihhbmltYXRpb25SZWNvcmQ6IE5ndEFuaW1hdGlvblJlY29yZCkge1xuICAgIGNvbnN0IHV1aWQgPSBhbmltYXRpb25SZWNvcmQub2JqPy51dWlkIHx8IG1ha2VJZCgpO1xuICAgIHRoaXMuYWN0aW9ucy5hbmltYXRpb25SZWNvcmQoeyAuLi5hbmltYXRpb25SZWNvcmQsIHV1aWQgfSk7XG4gICAgcmV0dXJuIHV1aWQ7XG4gIH1cblxuICBjb25zdHJ1Y3RvcigpIHtcbiAgICBzdXBlcigpO1xuICAgIHRoaXMuc2V0KHsgYW5pbWF0aW9uczoge30sIHN1YnNjcmliZXJzOiBbXSwgaGFzUHJpb3JpdHk6IGZhbHNlIH0pO1xuXG4gICAgdGhpcy5ob2xkKHRoaXMuc2VsZWN0KCdhbmltYXRpb25zJyksIChhbmltYXRpb25zKSA9PiB7XG4gICAgICBjb25zdCBzdWJzY3JpYmVycyA9IE9iamVjdC52YWx1ZXMoYW5pbWF0aW9ucyk7XG4gICAgICBzdWJzY3JpYmVycy5zb3J0KChhLCBiKSA9PiAoYS5wcmlvcml0eSB8fCAwKSAtIChiLnByaW9yaXR5IHx8IDApKTtcbiAgICAgIGNvbnN0IGhhc1ByaW9yaXR5ID0gc3Vic2NyaWJlcnMuc29tZSgoeyBwcmlvcml0eSB9KSA9PiAhIXByaW9yaXR5KTtcbiAgICAgIHRoaXMuc2V0KHsgaGFzUHJpb3JpdHksIHN1YnNjcmliZXJzIH0pO1xuICAgIH0pO1xuICAgIHRoaXMuaG9sZCh0aGlzLmFjdGlvbnMuYW5pbWF0aW9uUmVjb3JkJCwgdGhpcy4jcmVnaXN0ZXIuYmluZCh0aGlzKSk7XG4gICAgdGhpcy5ob2xkKHRoaXMuYWN0aW9ucy51bnN1YnNjcmliZXJVdWlkJCwgdGhpcy4jdW5yZWdpc3Rlci5iaW5kKHRoaXMpKTtcbiAgfVxuXG4gICNyZWdpc3RlcihcbiAgICB7IHV1aWQsIC4uLmFuaW1hdGlvblJlY29yZCB9OiBOZ3RBbmltYXRpb25SZWNvcmQgJiB7IHV1aWQ6IHN0cmluZyB9ID0ge1xuICAgICAgdXVpZDogJycsXG4gICAgICBjYWxsYmFjazogbm9vcCxcbiAgICB9XG4gICkge1xuICAgIGlmICh1dWlkKSB7XG4gICAgICB0aGlzLnNldCgoc3RhdGUpID0+IHtcbiAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICBhbmltYXRpb25zOiB7IC4uLnN0YXRlLmFuaW1hdGlvbnMsIFt1dWlkXTogYW5pbWF0aW9uUmVjb3JkIH0sXG4gICAgICAgIH07XG4gICAgICB9KTtcbiAgICB9XG5cbiAgICByZXR1cm4gKFxuICAgICAgcHJldlJlY29yZDogKE5ndEFuaW1hdGlvblJlY29yZCAmIHsgdXVpZDogc3RyaW5nIH0pIHwgdW5kZWZpbmVkLFxuICAgICAgaXNVbnN1YjogYm9vbGVhblxuICAgICkgPT4ge1xuICAgICAgaWYgKChwcmV2UmVjb3JkICYmIHByZXZSZWNvcmQudXVpZCAhPT0gdXVpZCkgfHwgaXNVbnN1Yikge1xuICAgICAgICB0aGlzLiN1bnJlZ2lzdGVyKHV1aWQpO1xuICAgICAgfVxuICAgIH07XG4gIH1cblxuICAjdW5yZWdpc3Rlcih1dWlkOiBzdHJpbmcpIHtcbiAgICBpZiAoIXV1aWQpIHJldHVybjtcbiAgICB0aGlzLnNldCgoc3RhdGUpID0+IHtcbiAgICAgIGNvbnN0IHsgW3V1aWRdOiBfLCAuLi5hbmltYXRpb25zIH0gPSBzdGF0ZS5hbmltYXRpb25zO1xuICAgICAgcmV0dXJuIHsgYW5pbWF0aW9ucyB9O1xuICAgIH0pO1xuICB9XG5cbiAgbmdPbkRlc3Ryb3koKSB7XG4gICAgdGhpcy5zZXQoeyBhbmltYXRpb25zOiB7fSB9KTtcbiAgICBzdXBlci5uZ09uRGVzdHJveSgpO1xuICB9XG59XG4iXX0=